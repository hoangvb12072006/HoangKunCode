<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOANGKUN STORE - PREMIUM GAMING SHOP</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>

        .logo:hover {
    filter: brightness(1.2); /* L√†m logo s√°ng h∆°n khi di chu·ªôt */
    text-shadow: 0 0 8px var(--primary); /* T·∫°o hi·ªáu ·ª©ng h√†o quang */
    transition: 0.3s;
}

        footer a:hover {
    color: var(--primary) !important;
    transition: 0.3s;
}

        /* Hi·ªáu ·ª©ng ch·ªØ l∆∞·ªõt s√°ng Gradient */
.glow-text {
    background: linear-gradient(to right, #ff0000 20%, #ffffff 40%, #ff4d4d 60%, #ff0000 80%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine-glow 4s linear infinite;
}

@keyframes shine-glow {
    to { background-position: 200% center; }
}

/* Hi·ªáu ·ª©ng d√≤ng ch·ªØ ph·ª• bay l√™n nh·∫π nh√†ng */
.sub-text {
    animation: fadeInUp 1.5s ease-out;
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 0.9; transform: translateY(0); }
}

/* Hi·ªáu ·ª©ng bo g√≥c v√† ƒë·ªï b√≥ng cho ·∫£nh s·∫£n ph·∫©m */
.thumb img {
    transition: transform 0.5s ease;
}
.card:hover .thumb img {
    transform: scale(1.1); /* Ph√≥ng to nh·∫π ·∫£nh khi di chu·ªôt v√†o */
}

/* L√†m cho c√°c n√∫t li√™n h·ªá (Zalo, FB) rung nh·∫π ƒë·ªÉ thu h√∫t s·ª± ch√∫ √Ω */
@keyframes shake {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(5deg); }
    50% { transform: rotate(-5deg); }
    100% { transform: rotate(0deg); }
}
.contact-item {
    animation: shake 2s infinite ease-in-out;
}

        .contact-sidebar {
    position: fixed;
    right: 20px;
    bottom: 80px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.contact-item {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    text-decoration: none;
    font-size: 24px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: 0.3s;
}

.contact-item:hover {
    transform: scale(1.1) translateX(-5px);
}

.zalo { background: #0068ff; }
.facebook { background: #1877f2; }
.telegram { background: #229ed9; }
        
        :root { --primary: #ff0000; --secondary: #121212; --accent: #ff4d4d; --text: #ffffff; --bg: #050505; --card-bg: #1a1a1a; }
        body { margin: 0; padding: 0; background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        
        /* Hi·ªáu ·ª©ng h·∫°t n·ªÅn */
        #particleCanvas { position: fixed; top: 0; left: 0; z-index: -1; background: radial-gradient(circle, #1a0000 0%, #050505 100%); }
        
        /* Navigation Bar */
        nav { background: rgba(0, 0, 0, 0.85); border-bottom: 2px solid var(--primary); padding: 15px 0; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(15px); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .nav-content { display: flex; justify-content: space-between; align-items: center; }
/* T√¨m ƒë·∫øn d√≤ng 24 v√† thay b·∫±ng ƒëo·∫°n n√†y */
.logo {
    font-size: 26px;
    font-weight: 900;
    text-transform: uppercase;
    animation: rgb-glow 4s infinite linear; /* Th√™m d√≤ng n√†y ƒë·ªÉ k√≠ch ho·∫°t ƒë·ªïi m√†u */
}

/* Th√™m hi·ªáu ·ª©ng ch·∫°y m√†u v√†o b·∫•t k·ª≥ ƒë√¢u trong th·∫ª <style> */
@keyframes rgb-glow {
    0% { color: #ff0000; text-shadow: 0 0 15px #ff0000; }
    33% { color: #00ff00; text-shadow: 0 0 15px #00ff00; }
    66% { color: #00ffff; text-shadow: 0 0 15px #00ffff; }
    100% { color: #ff0000; text-shadow: 0 0 15px #ff0000; }
}
        /* N√∫t b·∫•m x·ªãn */
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .btn-red { background: var(--primary); color: white; box-shadow: 0 0 15px rgba(255, 0, 0, 0.4); }
        .btn-red:hover { background: #ff3333; transform: scale(1.05); }
        
        /* Grid S·∫£n ph·∫©m */
        .shop-title { border-left: 5px solid var(--primary); padding-left: 15px; margin: 40px 0 20px; font-size: 22px; text-transform: uppercase; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: var(--card-bg); border-radius: 15px; overflow: hidden; border: 1px solid #222; transition: 0.4s; position: relative; }
        .card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(255,0,0,0.1); }
        .thumb { height: 180px; width: 100%; }
        .thumb img { width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 20px; text-align: center; }
        .price { color: var(--primary); font-size: 22px; font-weight: 800; margin: 10px 0; }

        /* Modal h·ªá th·ªëng */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px); }
        .modal-content { background: #151515; padding: 35px; border-radius: 20px; border: 1px solid #333; max-width: 400px; width: 90%; text-align: center; position: relative; }
        .input-group { position: relative; margin-bottom: 15px; text-align: left; }
        .input-group input { width: 100%; padding: 12px 15px; background: #000; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box; outline: none; }
        .input-group input:focus { border-color: var(--primary); }
        
        /* Th√¥ng b√°o gi·∫£ l·∫≠p */
        .fake-noti { position: fixed; bottom: -100px; left: 20px; background: rgba(20, 20, 20, 0.95); padding: 12px 20px; border-left: 4px solid var(--primary); border-radius: 8px; transition: 0.5s; z-index: 999; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .fake-noti.show { bottom: 20px; }

        /* L·ªãch s·ª≠ mua h√†ng */
        .history-box { margin-top: 50px; background: #111; padding: 20px; border-radius: 15px; border: 1px solid #222; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #222; }
        th { color: var(--primary); }
        
    </style>
</head>
<body>

    <canvas id="particleCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none;"></canvas>

<nav>
    <div class="container nav-content">
       <div class="logo">
    <a href="index.html" style="text-decoration: none; color: inherit;">
        <h1 style="margin: 0; cursor: pointer;">HOANGKUNSTORE</h1>
    </a>
</div>
        <div id="auth-section">
            <button class="btn btn-red" onclick="showAuth(false)">ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù</button>
        </div>
        <div id="user-section" style="display: none; align-items: center; gap: 15px;">
            <div style="font-size: 14px;">Xin ch√†o, <b id="display-name" style="color:var(--primary)">...</b></div>
            <div style="background: #222; padding: 5px 12px; border-radius: 20px; font-size: 14px;">
                <i class="fas fa-wallet" style="color:#00ff00"></i> <span id="user-balance">0ƒë</span>
            </div>
            <button class="btn btn-red" style="padding: 5px 10px; font-size: 12px;" onclick="showRecharge()">N·∫†P</button>
            <i class="fas fa-sign-out-alt" style="cursor:pointer; color: #666;" onclick="logout()"></i>
        </div>
    </div>
</nav>

<div class="container">
   <div class="banner" style="text-align: center; padding: 100px 0; background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://i.postimg.cc/g2bY136T/Website-1024x538.png') center/cover; border-radius: 20px; margin-top: 20px; border: 1px solid #444; position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
    <h1 class="glow-text" style="font-size: 65px; margin: 0; letter-spacing: 4px; font-weight: 900; text-transform: uppercase; line-height: 1.2;">
        HOANGKUN STORE
    </h1>
    
    <div style="width: 120px; height: 4px; background: var(--primary); margin: 25px auto; border-radius: 10px; box-shadow: 0 0 20px var(--primary);"></div>
    
    <p class="sub-text" style="color: #ffffff; font-size: 18px; letter-spacing: 1px; opacity: 0.9; text-shadow: 1px 1px 5px rgba(0,0,0,0.5);">
        <i class="fas fa-check-circle" style="color: var(--primary);"></i> 
        H·ªÜ TH·ªêNG SOURCE CODE T·ª∞ ƒê·ªòNG - UY T√çN - B·∫¢O M·∫¨T
        <i class="fas fa-check-circle" style="color: var(--primary);"></i>
    </p>
</div>

    <div class="container" style="margin-top: 40px;">
    <div style="background: rgba(15, 15, 15, 0.95); border: 1px solid #333; border-radius: 20px; padding: 25px; box-shadow: 0 0 25px rgba(255, 0, 0, 0.15);">
        <h2 style="text-align: center; color: #fff; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 25px; font-weight: 800;">
            <i class="fas fa-trophy" style="color: gold; margin-right: 10px;"></i> 
            TOP 10 ƒê·∫†I GIA N·∫†P NHI·ªÄU
            <i class="fas fa-trophy" style="color: gold; margin-left: 10px;"></i>
        </h2>
        <div class="table-responsive" style="border-radius: 15px; overflow: hidden;">
            <table class="table" style="color: white; margin-bottom: 0;">
                <thead style="background: linear-gradient(90deg, #ff0000, #990000); color: white;">
                    <tr>
                        <th style="text-align: center; width: 80px; border: none;">H·∫†NG</th>
                        <th style="border: none;">KH√ÅCH H√ÄNG</th>
                        <th style="text-align: center; border: none;">S·ªê D∆Ø HI·ªÜN T·∫†I</th>
                    </tr>
                </thead>
                <tbody id="top-nap-body">
                    </tbody>
            </table>
        </div>
    </div>
</div>

    <h2 class="shop-title"><i class="fas fa-fire"></i> S·∫£n ph·∫©m m·ªõi nh·∫•t</h2>
    <div class="grid" id="productGrid"></div>

   <div id="history-section" class="history-box" style="display:none; border: 1px solid var(--primary); margin-top: 30px;">
    <h3 style="color: var(--primary); text-align: center;"><i class="fas fa-shopping-cart"></i> L·ªäCH S·ª¨ GIAO D·ªäCH & KHO CODE</h3>
    <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
        <thead>
            <tr style="background: #222; color: #fff;">
                <th style="width: 30%; padding: 10px; border: 1px solid #333;">T√™n S·∫£n Ph·∫©m</th>
                <th style="width: 15%; border: 1px solid #333;">Gi√°</th>
                <th style="width: 30%; border: 1px solid #333;">Ng√†y Mua</th>
                <th style="width: 25%; border: 1px solid #333;">Link T·∫£i</th>
            </tr>
        </thead>
        <tbody id="history-body"></tbody>
    </table>
</div>
    
<div id="authModal" class="modal">
    <div class="modal-content">
        <h2 id="authTitle" style="margin-top:0">LOGIN</h2>
        <div class="input-group">
            <label style="font-size: 12px; color: #666;">T√™n t√†i kho·∫£n</label>
            <input type="text" id="userInput" placeholder="G√µ t√™n t√†i kho·∫£n...">
        </div>
        <div class="input-group">
            <label style="font-size: 12px; color: #666;">M·∫≠t kh·∫©u</label>
            <input type="password" id="passInput" placeholder="*******">
        </div>
        <div id="regFields" style="display: none;">
            <div class="input-group">
                <label style="font-size: 12px; color: #666;">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                <input type="password" id="confirmInput" placeholder="*******">
            </div>
        </div>
        <button class="btn btn-red" style="width: 100%; margin-top: 10px;" onclick="handleAuth()">X√ÅC NH·∫¨N</button>
        <p class="auth-switch">
            <span id="switchText">Ch∆∞a c√≥ t√†i kho·∫£n?</span> 
            <b onclick="toggleAuth()" style="color:var(--primary); cursor:pointer">B·∫•m v√†o ƒë√¢y</b>
        </p>o
        <div style="margin-top: 20px; font-size: 13px; color: #444; cursor: pointer;" onclick="closeModal('authModal')">ƒê√≥ng c·ª≠a s·ªï</div>
    </div>
</div>
<div id="rechargeModal" class="modal">
    <div class="modal-content" style="max-width: 500px; padding: 0; overflow: hidden; background: #fff; border: none; border-radius: 15px;">
        
        <div style="display: flex; background: #f8f9fa; border-bottom: 1px solid #ddd;">
            <div id="re-tab0" onclick="switchRechargeTab('atm')" style="flex: 1; padding: 15px; cursor: pointer; color: #ff4747; font-weight: bold; border-bottom: 3px solid #ff4747; text-align: center;">N·∫°p ATM</div>
            <div id="re-tab1" onclick="switchRechargeTab('card')" style="flex: 1; padding: 15px; cursor: pointer; color: #555; font-weight: bold; text-align: center;">N·∫°p th·∫ª</div>
            <div id="re-tab2" onclick="switchRechargeTab('top')" style="flex: 1; padding: 15px; cursor: pointer; color: #555; font-weight: bold; text-align: center;">Top n·∫°p</div>
            <div id="re-tab3" onclick="switchRechargeTab('reward')" style="flex: 1; padding: 15px; cursor: pointer; color: #555; font-weight: bold; text-align: center;">Ph·∫ßn th∆∞·ªüng</div>
        </div>

       <div id="con-atm" style="padding: 20px; display: block; text-align: left;">
    <div style="background: #fdf2f2; border: 1px solid #ff4747; padding: 15px; border-radius: 10px; display: flex; align-items: center; gap: 15px;">
        <div style="flex: 1;">
            <p style="margin-bottom: 8px; color: #333;">üè¶ <b>Ng√¢n h√†ng: TECHCOMBANK</b></p>
            <p style="margin-bottom: 8px; color: #333;">üí≥ <b>S·ªë t√†i kho·∫£n:</b> <b style="color: #ff4747; font-size: 16px;">3120720060</b></p>
            <p style="margin-bottom: 8px; color: #333;">üë§ <b>Ch·ªß TK:</b> NGUYEN VIET HOANG</p>
            <p style="margin-bottom: 10px; color: #333;">üìù <b>N·ªôi dung:</b> <b id="nap-memo" style="background: #fff3cd; padding: 2px 5px;">nap "tendangnhap"</b></p>
            <p style="font-size: 11px; color: #666; font-style: italic;">* H·ªá th·ªëng t·ª± ƒë·ªông c·ªông ti·ªÅn sau 1-5 ph√∫t.</p>
        </div>
        
        <div style="width: 140px; text-align: center; background: #fff; padding: 5px; border-radius: 8px; border: 1px solid #eee;">
            <img src="https://sf-static.upanhlaylink.com/img/image_20260205f3c1d35d1bea8ccfc990947f98624b14.jpg" 
                 alt="QR N·∫°p Ti·ªÅn" 
                 style="width: 100%; display: block; border-radius: 5px;">
            <span style="font-size: 10px; color: #ff4747; font-weight: bold; display: block; margin-top: 5px;">QU√âT M√É N·∫†P</span>
        </div>
    </div>
</div>

        <div id="con-card" style="padding: 20px; display: none;">
            <select id="cardType" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="">Ch·ªçn nh√† m·∫°ng</option>
                <option value="VIETTEL">Viettel</option>
                <option value="VINAPHONE">Vinaphone</option>
                <option value="MOBIFONE">Mobifone</option>
            </select>
            <select id="cardValue" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="">Ch·ªçn m·ªánh gi√°</option>
                <option value="10000">10,000ƒë</option>
                <option value="20000">20,000ƒë</option>
                <option value="50000">50,000ƒë</option>
                <option value="100000">100,000ƒë</option>
                <option value="200000">200,000ƒë</option>
                <option value="500000">500,000ƒë</option>
            </select>
            <input type="text" id="cardSeri" placeholder="Nh·∫≠p s·ªë Seri" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
            <input type="text" id="cardPin" placeholder="Nh·∫≠p m√£ th·∫ª" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px; border:1px solid #ddd;">
            <button class="btn-red" style="width:100%; padding:15px; border-radius:8px; border:none; background:#ff4747; color:#fff; font-weight:bold; cursor:pointer;" onclick="sendCard()">N·∫°p Ngay</button>
        </div>

        <div id="con-top" style="padding: 15px; display: none; max-height: 300px; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse; color: #333; font-size: 14px;">
                <thead>
                    <tr style="border-bottom: 2px solid #eee; color: #888;">
                        <th style="padding: 10px; text-align: left;">H·∫°ng</th>
                        <th style="padding: 10px; text-align: left;">Ng∆∞·ªùi d√πng</th>
                        <th style="padding: 10px; text-align: right;">S·ªë ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody id="top-recharge-modal-body"></tbody>
            </table>
        </div>

        <div id="con-reward" style="padding: 20px; display: none; text-align: left;">
            <div style="background: #fff5f5; border-left: 4px solid #ff4747; padding: 15px; border-radius: 8px;">
                <p style="color: #d9534f; font-weight: bold; margin-bottom: 10px; font-size: 16px;">üéÅ ƒêUA TOP N·∫†P TH√ÅNG 02</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 5px; border: 1px solid #ffebeb;">
                        <span>ü•á <b>Top 1</b></span>
                        <b style="color: #ff4747;">500.000 VNƒê</b>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 5px; border: 1px solid #ffebeb;">
                        <span>ü•à <b>Top 2</b></span>
                        <b style="color: #ff4747;">200.000 VNƒê</b>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 5px; border: 1px solid #ffebeb;">
                        <span>ü•â <b>Top 3</b></span>
                        <b style="color: #ff4747;">100.000 VNƒê</b>
                    </div>
                </div>
                <p style="font-size: 11px; color: #888; margin-top: 10px; font-style: italic;">* Ph·∫ßn th∆∞·ªüng c·ªông v√†o t√†i kho·∫£n cu·ªëi th√°ng</p>
            </div>
        </div>

        <div style="padding: 15px; border-top: 1px solid #eee;">
            <button class="btn" style="width: 100%; background: #666; color:#fff;" onclick="closeModal('rechargeModal')">ƒê√≥ng</button>
        </div>
    </div> </div> 

    <script>

        function loadTopRechargeModal() {
    const topBody = document.getElementById('top-recharge-modal-body');
    if (!topBody) return;

    // L·∫•y danh s√°ch user, s·∫Øp x·∫øp theo balance ho·∫∑c m·ªôt tr∆∞·ªùng 'total_n·∫°p' n·∫øu b·∫°n c√≥
    db.ref('users').orderByChild('balance').limitToLast(10).on('value', snapshot => {
        let html = '';
        let rank = 1;
        let users = [];

        snapshot.forEach(child => {
            users.push(child.val());
        });
        
        // ƒê·∫£o ng∆∞·ª£c danh s√°ch ƒë·ªÉ ng∆∞·ªùi cao nh·∫•t l√™n ƒë·∫ßu
        users.reverse().forEach(user => {
            let color = rank <= 3 ? '#ff4747' : '#555'; // Top 3 ƒë·ªÉ m√†u ƒë·ªè cho n·ªïi
            html += `
                <tr style="border-bottom: 1px solid #f9f9f9;">
                    <td style="padding: 10px; font-weight: bold; color: ${color};">#${rank}</td>
                    <td style="padding: 10px;">${user.username || user.name || 'Kh√°ch'}</td>
                    <td style="padding: 10px; text-align: right; font-weight: bold; color: #28a745;">
                        ${(user.balance || 0).toLocaleString()}ƒë
                    </td>
                </tr>
            `;
            rank++;
        });
        topBody.innerHTML = html;
    });
}

    let isSpinning = false; // Th√™m d√≤ng n√†y ·ªü ƒë·∫ßu file Script
    
    // --- 1. K·∫æT N·ªêI FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyDqpk71mVDWCP3jk7fxbHZayz92LTheY7g",
        databaseURL: "https://hoangkun-594d0-default-rtdb.firebaseio.com",
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
        

     // --- 1. H√†m chuy·ªÉn Tab n·∫°p ti·ªÅn ---
function switchRechargeTab(tab) {
    const tabs = ['card', 'top', 'reward'];
    tabs.forEach(t => {
        const content = document.getElementById('con-' + t);
        const btn = document.getElementById('re-tab' + (tabs.indexOf(t) + 1));
        if(content) content.style.display = (t === tab) ? 'block' : 'none';
        if (btn) {
            btn.style.color = (t === tab) ? '#ff4747' : '#555';
            btn.style.borderBottom = (t === tab) ? '3px solid #ff4747' : 'none';
        }
   }); // K·∫øt th√∫c tabs.forEach

    if (tab === 'top') {
        loadTopRechargeModal();
    }
} // K·∫øt th√∫c h√†m switchRechargeTab t·∫°i ƒë√¢y (D√≤ng 482)

function showRecharge() {
    const user = localStorage.getItem('hoangUser');
    if (!user) return showAuth(false);
    
    document.getElementById('rechargeModal').style.display = 'flex';
    switchRechargeTab('atm'); 

    // T·ª± ƒë·ªông ƒëi·ªÅn n·ªôi dung: nap + t√™n t√†i kho·∫£n
    const memoElement = document.getElementById('nap-memo');
    if (memoElement) {
        memoElement.innerText = `nap ${user}`;
    }
}
        
function sendCard() {
    const user = localStorage.getItem('hoangUser');
    const type = document.getElementById('cardType').value;
    const value = document.getElementById('cardValue').value;
    const seri = document.getElementById('cardSeri').value.trim();
    const pin = document.getElementById('cardPin').value.trim();
    
    if(!type || !value || !seri || !pin) {
        return Swal.fire("L·ªói", "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin th·∫ª!", "error");
    }

    // Hi·ªáu ·ª©ng "ƒêang g·ª≠i" cho x·ªãn
    Swal.fire({
        title: 'ƒêang g·ª≠i th·∫ª...',
        didOpen: () => { Swal.showLoading(); }
    });

    // L∆∞u th√¥ng tin th·∫ª v√†o nh√°nh 'card_requests' tr√™n Firebase
    db.ref('card_requests').push({
        username: user,
        cardType: type,
        cardValue: value,
        seri: seri,
        pin: pin,
        status: "pending",
        time: new Date().toLocaleString()
    }).then(() => {
        Swal.fire("Th√†nh c√¥ng", "Th·∫ª ƒë√£ ƒë∆∞·ª£c g·ª≠i! Ch·ªù Admin duy·ªát nh√©.", "success");
        closeModal('rechargeModal');
        // X√≥a tr·∫Øng √¥ nh·∫≠p ƒë·ªÉ l·∫ßn sau n·∫°p ti·∫øp
        document.getElementById('cardSeri').value = '';
        document.getElementById('cardPin').value = '';
    }).catch(err => Swal.fire("L·ªói", err.message, "error"));
}
    

   // Thay th·∫ø ƒëo·∫°n c≈© b·∫±ng ƒëo·∫°n n√†y:
const products = [
    { id: 1, name: "CODE TRAITYM 1", price: 22000, img: "https://cellphones.com.vn/sforum/wp-content/uploads/2024/03/Huong-dan-tao-code-trai-tim-html-tang-nguoi-than-yeu-nhan-ngay-8-3-3.jpg", link: "https://www.mediafire.com/file/x82cfpep8576y2m/Code_tr%25C3%25A1i_tym_1.zip/file" },
    { id: 2, name: "CODE TRAITYM 2", price: 28000, img: "https://cellphones.com.vn/sforum/wp-content/uploads/2024/03/Huong-dan-tao-code-trai-tim-html-tang-nguoi-than-yeu-nhan-ngay-8-3-9.jpg", link: "https://www.mediafire.com/file/9ouog8a5ot8bbjr/Code_tr%25C3%25A1i_tym_2.zip/file" },
    { id: 3, name: "CODE TRAITYM 3", price: 32000, img: "https://cellphones.com.vn/sforum/wp-content/uploads/2024/03/Huong-dan-tao-code-trai-tim-html-tang-nguoi-than-yeu-nhan-ngay-8-3-13.jpg", link: "https://www.mediafire.com/file/y5koz065nphas87/Code_tr%25C3%25A1i_tym_3.zip/file" },
    { id: 4, name: "CODE WEB SHOP", price: 350000, img: "https://i.postimg.cc/JzmdcN7p/game-title.jpg", link: "https://www.mediafire.com/file/kpd7vqbm7235b46/Code+website+Game.zip/file" },
    { id: 5, name: "CODE GAME B·∫ÆN CUNG", price: 60000, img: "https://i.postimg.cc/svBYRYkr/IMG-6222.png", link: "https://www.mediafire.com/file/fppnwb0cye4f8p7/Code_ba%25CC%2586%25CC%2581n_cung.zip/file" },
    { id: 6, name: "CODE WEB M√àO CUTE", price: 75000, img: "https://i.postimg.cc/QKFThDy3/IMG-6223.gif", link: "https://www.mediafire.com/file/tcobfv1lccqrvjb/Code_chu%25CC%2581c_mu%25CC%259B%25CC%2580ng_sinh_nha%25CC%25A3%25CC%2582t_1.zip/file" },
    { id: 7, name: "CODE HI·ªÜU ·ª®NG R·ªíNG", price: 69000, img: "https://i.postimg.cc/Czfq2F8R/IMG-6224.gif", link: "https://www.mediafire.com/file/csvufyf40lrz37s/Code_hie%25CC%25A3%25CC%2582u_u%25CC%259B%25CC%2581ng_tro%25CC%2589_chuo%25CC%25A3%25CC%2582t_1.zip/file" },
    { id: 8, name: "CODE HI·ªÜU ·ª®NG CHU·ªòT 2", price: 65000, img: "https://i.postimg.cc/K3mMVW6Q/IMG-6225.gif", link: "https://www.mediafire.com/file/rzwparz9rv49icq/Code_Hie%25CC%25A3%25CC%2582u_U%25CC%259B%25CC%2581ng_Chuo%25CC%25A3%25CC%2582t_2.zip/file" },
    { id: 10, name: "Code Th∆∞ T·ªè T√¨nh", price: 50000, img: "https://i.postimg.cc/q62Czw4K/IMG-6227.gif", link: "https://www.mediafire.com/file/689n10vjdpsnnfv/Code_Thu%25CC%259B_To%25CC%2589_Ti%25CC%2580nh.zip/file" },
    { id: 11, name: "Code Thi·ªáp Ch√∫c Gi√°ng Sinh", price: 51000, img: "https://i.postimg.cc/3yHJnG5Y/IMG-6228.png", link: "https://www.mediafire.com/file/t914seytwtw0me0/Code_Thu%25CC%259B_Gia%25CC%2581ng_Sinh.zip/file" },
    { id: 12, name: "CODE HI·ªÜU ·ª®NG CHU·ªòT 4", price: 63000, img: "https://i.postimg.cc/NKjWYf6d/IMG-6231.gif", link: "https://www.mediafire.com/file/e064bjd9uyb8z75/Code_Hie%25CC%25A3%25CC%2582u_U%25CC%259B%25CC%2581ng_Chuo%25CC%25A3%25CC%2582t_4.zip/file" },
    { id: 13, name: "CODE HI·ªÜU ·ª®NG CHU·ªòT 5", price: 58000, img: "https://i.postimg.cc/HrkfHswf/IMG-6232.gif", link: "https://www.mediafire.com/file/6zwm6ew9ygnr1u3/Code_Hie%25CC%25A3%25CC%2582u_U%25CC%259B%25CC%2581ng_Chuo%25CC%25A3%25CC%2582t_5.zip/file" },
    { id: 14, name: "CODE HI·ªÜU ·ª®NG LOADDING", price: 21000, img: "https://i.postimg.cc/pmLgxXfS/IMG-6233.png", link: "https://www.mediafire.com/file/zgsje7jjri4wh7t/Code_Hie%25CC%25A3%25CC%2582u_U%25CC%259B%25CC%2581ng_Loadding.zip/file" },
    { id: 15, name: "Code Qly Web Tr∆∞·ªùng H·ªçc", price: 220000, img: "https://i.postimg.cc/G3B9xytZ/Untitled.png", link: "https://www.mediafire.com/file/xd5x96ia1g6arbv/Code+website+qu·∫£n+l√Ω+tr∆∞·ªùng+h·ªçc.zip/file" },
    { id: 16, name: "CODE WEBSITE ", price: 200000, img: "https://i.postimg.cc/DzqnVxw3/Untitled.png", link: "https://www.mediafire.com/file/g65sp328f6xfwvl/Code+website.zip/file" }
];
    function renderProducts() {
        document.getElementById('productGrid').innerHTML = products.map(p => `
            <div class="card">
                <div class="thumb"><img src="${p.img}"></div>
                <div class="card-body">
                    <h3 style="font-size:16px; margin:0;">${p.name}</h3>
                    <div class="price">${p.price.toLocaleString()}ƒë</div>
                    <button class="btn btn-red" style="width:100%" onclick="buyItem('${p.name}', ${p.price}, '${p.link}')">MUA NGAY</button>
                </div>
            </div>
        `).join('');
    }

    // --- 3. LOGIC T√ÄI KHO·∫¢N (ƒê√É FIX L·ªñI) ---
    let isRegisterMode = false;

    function showAuth(isReg) {
        isRegisterMode = isReg;
        updateAuthUI();
        document.getElementById('authModal').style.display = 'flex';
    }

    function toggleAuth() {
        isRegisterMode = !isRegisterMode;
        updateAuthUI();
    }

    function updateAuthUI() {
        document.getElementById('authTitle').innerText = isRegisterMode ? "ƒêƒÇNG K√ù" : "ƒêƒÇNG NH·∫¨P";
        document.getElementById('regFields').style.display = isRegisterMode ? "block" : "none";
        document.getElementById('switchText').innerText = isRegisterMode ? "ƒê√£ c√≥ t√†i kho·∫£n?" : "Ch∆∞a c√≥ t√†i kho·∫£n?";
    }

    function handleAuth() {
        const user = document.getElementById('userInput').value.trim().toLowerCase();
        const pass = document.getElementById('passInput').value;

        if(!user || !pass) return Swal.fire("L·ªói", "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!", "error");

        if(isRegisterMode) {
            const confirm = document.getElementById('confirmInput').value;
            if(pass !== confirm) return Swal.fire("L·ªói", "M·∫≠t kh·∫©u kh√¥ng kh·ªõp!", "error");

            db.ref('users/' + user).once('value').then(snap => {
                if(snap.exists()) {
                    Swal.fire("L·ªói", "T√™n t√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!", "error");
                } else {
                    db.ref('users/' + user).set({
                        pass: pass,
                        balance: 0,
                        createdAt: new Date().toLocaleString()
                    }).then(() => {
                        Swal.fire("Th√†nh c√¥ng", "ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y ƒëƒÉng nh·∫≠p.", "success");
                        isRegisterMode = false;
                        updateAuthUI();
                    });
                }
            });
        } else {
            db.ref('users/' + user).once('value').then(snap => {
                const data = snap.val();
                if(data && data.pass === pass) {
                    localStorage.setItem('hoangUser', user);
                    Swal.fire("Ch√†o m·ª´ng", "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "success").then(() => location.reload());
                } else {
                    Swal.fire("L·ªói", "Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!", "error");
                }
            });
        }
    }

       function checkLogin() {
    const user = localStorage.getItem('hoangUser');
    const userSection = document.getElementById('user-section');
    const authSection = document.getElementById('auth-section');

    if(user && userSection) {
        authSection.style.display = 'none';
        userSection.style.display = 'flex';
        document.getElementById('history-section').style.display = 'block';
        
        // ƒêo·∫°n n√†y ƒë√£ b·ªè n√∫t Trang c√° nh√¢n l·ªói
        userSection.innerHTML = `
            <span style="color: #fff; margin-right: 10px;">Ch√†o, <b style="color:var(--primary)">${user}</b></span>
            <div style="background: #222; padding: 5px 12px; border-radius: 20px; font-size: 14px; margin-right: 10px;">
                <i class="fas fa-wallet" style="color:#00ff00"></i> <span id="user-balance">0ƒë</span>
            </div>
            <button class="btn btn-red" style="padding: 5px 10px; font-size: 12px;" onclick="showRecharge()">N·∫†P</button>
            <i class="fas fa-sign-out-alt" style="cursor:pointer; color: #666; margin-left:10px" onclick="logout()"></i>
        `;
        
        db.ref('users/' + user).on('value', snap => {
            const data = snap.val();
            if(data) {
                const balance = data.balance || 0;
                const balEl = document.getElementById('user-balance');
                if(balEl) balEl.innerText = balance.toLocaleString() + 'ƒë';
            }
        });
        loadHistory(user);
    }
}

    isSpinning = true;
    document.getElementById('spinBtn').disabled = true;
    document.getElementById('wheelResult').innerText = "ƒêang quay...";
    
    // C·∫≠p nh·∫≠t tr·ª´ ti·ªÅn/l∆∞·ª£t ngay ƒë·ªÉ ch·ªëng gian l·∫≠n
    await db.ref('users/' + user).update({ balance: balance, freeSpins: freeSpins });
    document.getElementById('free-spins').innerText = freeSpins;

    // Logic t√≠nh k·∫øt qu·∫£ d·ª±a tr√™n Weight (T·ªâ l·ªá ƒë√£ ch·ªânh)
    let totalWeight = prizes.reduce((sum, p) => sum + (p.weight || 1), 0);
    let randomNum = Math.random() * totalWeight;
    let weightSum = 0;
    let prizeIndex = 0;

    for (let i = 0; i < prizes.length; i++) {
        weightSum += (prizes[i].weight || 1);
        if (randomNum <= weightSum) {
            prizeIndex = i;
            break;
        }
    }

    // T√≠nh to√°n g√≥c quay (Quay √≠t nh·∫•t 10 v√≤ng + g√≥c d·ª´ng)
    const sectorAngle = 360 / prizes.length; 
   // Th√™m -90 v√†o cu·ªëi ƒë·ªÉ b√π ƒë·∫Øp g√≥c l·ªách gi·ªØa Canvas v√† Kim ch·ªâ
const stopAngle = 360 - (prizeIndex * sectorAngle) - (sectorAngle / 2) - 90;
    const spinAngle = 3600 + stopAngle; 

    const canvas = document.getElementById('wheelCanvas');
    canvas.style.transition = 'transform 4s cubic-bezier(0.1, 0, 0.2, 1)';
    canvas.style.transform = `rotate(${spinAngle}deg)`;

    // ƒê·ª£i quay xong (4 gi√¢y)
    setTimeout(() => {
        isSpinning = false;
        document.getElementById('spinBtn').disabled = false;
        const finalPrize = prizes[prizeIndex];

        // C·ªông ti·ªÅn th∆∞·ªüng
        db.ref('users/' + user).once('value').then(s => {
            const currentBal = s.val().balance || 0;
            db.ref('users/' + user).update({ balance: currentBal + finalPrize.value });
            
            // Hi·ªán th√¥ng b√°o ƒë·∫πp m·∫Øt
            if(finalPrize.value > 0) {
                Swal.fire("Ch√∫c m·ª´ng!", `B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c ${finalPrize.label}`, "success");
            } else {
                Swal.fire("Ti·∫øc qu√°!", "Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau!", "info");
            }
            document.getElementById('wheelResult').innerText = `K·∫øt qu·∫£: ${finalPrize.label}`;
        });

        // Reset nh·∫π g√≥c quay ƒë·ªÉ l·∫ßn sau quay ti·∫øp kh√¥ng b·ªã l·ªói
        setTimeout(() => {
            canvas.style.transition = 'none';
            canvas.style.transform = `rotate(${stopAngle}deg)`;
            setTimeout(() => canvas.style.transition = 'transform 4s cubic-bezier(0.1, 0, 0.2, 1)', 50);
        }, 500);
    }, 4000);
}
    
// C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t free hi·ªÉn th·ªã
function updateWheelUI(user) {
    db.ref('users/' + user).on('value', snap => {
        const data = snap.val();
        if(data) document.getElementById('free-spins').innerText = data.freeSpins || 0;
    });
}

   function buyItem(name, price, downloadLink) {
    const user = localStorage.getItem('hoangUser');
    if(!user) return showAuth(false);

    const currentBal = parseInt(localStorage.getItem('hoangBal') || 0);
    if(currentBal < price) {
        Swal.fire("Thi·∫øu ti·ªÅn", "S·ªë d∆∞ kh√¥ng ƒë·ªß!", "warning").then(() => showRecharge());
        return;
    }

    Swal.fire({
        title: 'X√°c nh·∫≠n mua?',
        text: `Mua ${name} v·ªõi gi√° ${price.toLocaleString()}ƒë?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#ff0000',
        confirmButtonText: 'MUA NGAY'
    }).then((result) => {
        if (result.isConfirmed) {
            const newBal = currentBal - price;
            const now = new Date().toLocaleString();

            // Ch·ªâ l∆∞u v√†o 1 b·∫£ng duy nh·∫•t l√† 'history' nh∆∞ng c√≥ th√™m link
            db.ref('history/' + user).push({
                product: name,
                price: price,
                date: now,
                link: downloadLink, // L∆∞u link v√†o ƒë√¢y lu√¥n
                status: "Th√†nh c√¥ng"
            });

// T·∫∂NG L∆Ø·ª¢T QUAY: C·ª© m·ªói 50.000ƒë gi√° tr·ªã m√≥n h√†ng ƒë∆∞·ª£c 1 l∆∞·ª£t
            let bonusSpins = Math.floor(price / 50000); 

            if (bonusSpins > 0) {
                db.ref('users/' + user).once('value').then(snapshot => {
                    let userData = snapshot.val() || {};
                    let currentFreeSpins = userData.freeSpins || 0;
                    
                    db.ref('users/' + user).update({
                        balance: newBal,
                        freeSpins: currentFreeSpins + bonusSpins
                    });
                    
                    Swal.fire("Th√†nh c√¥ng", `B·∫°n ƒë√£ mua ${name} v√† ƒë∆∞·ª£c t·∫∑ng ${bonusSpins} l∆∞·ª£t quay!`, "success");
                });
            } else {
                db.ref('users/' + user).update({ balance: newBal });
                Swal.fire("Th√†nh c√¥ng", `B·∫°n ƒë√£ mua ${name} th√†nh c√¥ng!`, "success");
            }
        } // K·∫øt th√∫c if (result.isConfirmed)
    }); // K·∫øt th√∫c .then c·ªßa Swal
} // K·∫øt th√∫c function buyItem
            
  function loadHistory(user) {
    db.ref('history/' + user).on('value', snap => {
        const historyBody = document.getElementById('history-body');
        const data = snap.val();
        if(!data) {
            historyBody.innerHTML = '<tr><td colspan="4" style="text-align:center">Ch∆∞a c√≥ giao d·ªãch n√†o</td></tr>';
            return;
        }

        let html = '';
        for(let id in data) {
            html = `<tr>
                <td style="color:#fff; padding: 10px; border: 1px solid #333;">${data[id].product}</td>
                <td style="color:var(--primary); border: 1px solid #333;">${(data[id].price || 0).toLocaleString()}ƒë</td>
                <td style="color:#ccc; font-size: 13px; border: 1px solid #333;">${data[id].date}</td>
                <td style="text-align: center; border: 1px solid #333;">
                    <a href="${data[id].link || '#'}" target="_blank" 
                       style="color:#00ff00; text-decoration:none; font-weight:bold; border:1px solid #00ff00; padding:3px 8px; border-radius:4px; font-size:12px;">
                       <i class="fas fa-download"></i> T·∫¢I V·ªÄ
                    </a>
                </td>
            </tr>` + html;
        }
        historyBody.innerHTML = html;
    });
}

    function logout() { localStorage.removeItem('hoangUser'); location.reload(); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
  
    // --- 5. HI·ªÜU ·ª®NG V√Ä TRANG TR√ç ---
    function initParticles() {
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        for(let i=0; i<60; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: Math.random() - 0.5,
                vy: Math.random() - 0.5
            });
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "rgba(255, 0, 0, 0.2)";
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
                ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        animate();
    }

    function startFakeNoti() {
        const names = ["Qu·ªëc B·∫£o", "VƒÉn Nam", "Thanh T√πng", "Minh H·∫±ng", "ƒê·ª©c Huy"];
        const prices = ["50,000ƒë", "200,000ƒë", "100,000ƒë", "500,000ƒë"];
        setInterval(() => {
            const noti = document.getElementById('fakeNoti');
            document.getElementById('fakeNotiText').innerHTML = `Kh√°ch h√†ng <b>${names[Math.floor(Math.random()*names.length)]}</b> v·ª´a n·∫°p th√†nh c√¥ng ${prices[Math.floor(Math.random()*prices.length)]}`;
            noti.classList.add('show');
            setTimeout(() => noti.classList.remove('show'), 5000);
        }, 12000);
    }

    window.onload = () => {
        initParticles();
        renderProducts();
        checkLogin();
        startFakeNoti();
    };
</script>

    <script>
    const canvas = document.getElementById('particleCanvas');
    if(canvas) {
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particles = [];
        for(let i=0; i<100; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 1,
                speedY: Math.random() * 1 + 0.5
            });
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
            particles.forEach(p => {
                p.y -= p.speedY;
                if(p.y < 0) p.y = canvas.height;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        animate();
    }

        function loadBoughtCodes(user) {
    db.ref('bought_codes/' + user).on('value', snap => {
        const data = snap.val();
        const body = document.getElementById('kho-code-body');
        if (!data) return;

        let html = '';
        for (let id in data) {
            html = `<tr>
                <td>${data[id].name}</td>
                <td>${data[id].date}</td>
                <td><a href="${data[id].link}" target="_blank" style="color:#00ff00; text-decoration:none; font-weight:bold;">[T·∫¢I V·ªÄ]</a></td>
            </tr>` + html;
        }
        body.innerHTML = html;
    });
}

        function loadTopTen() {
    db.ref('users').on('value', snap => {
        const users = snap.val();
        if (!users) return;

        let userArray = [];
        for (let username in users) {
            userArray.push({
                name: username,
                balance: users[username].balance || 0
            });
        }

        // S·∫Øp x·∫øp ai nhi·ªÅu ti·ªÅn h∆°n ƒë·ª©ng tr∆∞·ªõc
        userArray.sort((a, b) => b.balance - a.balance);

        const top10 = userArray.slice(0, 10);
        let html = '';

        top10.forEach((user, index) => {
            let rank = index + 1;
            let icon = rank;
            let nameColor = "#eee";

            if (index === 0) { icon = 'üëë'; nameColor = "gold"; }
            else if (index === 1) { icon = 'ü•à'; nameColor = "silver"; }
            else if (index === 2) { icon = 'ü•â'; nameColor = "#cd7f32"; }

            html += `
                <tr style="border-bottom: 1px solid #222; background: rgba(255,255,255,0.03);">
                    <td style="text-align: center; font-weight: bold; padding: 12px;">${icon}</td>
                    <td style="font-weight: 600; color: ${nameColor}; padding: 12px;">${user.name}</td>
                    <td style="text-align: center; color: #00ff00; font-weight: bold; padding: 12px;">
                        ${user.balance.toLocaleString()}ƒë
                    </td>
                </tr>
            `;
        });
        document.getElementById('top-nap-body').innerHTML = html;
    });
}
// Ch·∫°y h√†m
loadTopTen();

function openProfile() {
    const user = localStorage.getItem('hoangUser');
    if (!user) return typeof showAuth === 'function' ? showAuth(false) : alert("Vui l√≤ng ƒëƒÉng nh·∫≠p!");

    // 1. ·∫®n t·∫•t c·∫£ n·ªôi dung ch√≠nh c·ªßa shop ƒë·ªÉ hi·ªán trang c√° nh√¢n
    const mainElements = document.querySelectorAll('section, .container-fluid, #main-content, .banner, .shop-title, .grid');
    mainElements.forEach(el => el.style.display = 'none');

    // 2. Hi·ªán khung profile-page
    const profilePage = document.getElementById('profile-page');
    if (profilePage) {
        profilePage.style.display = 'block';
    } else {
        return console.error("Kh√¥ng t√¨m th·∫•y ID 'profile-page' trong HTML!");
    }

    // 3. Hi·ªÉn th·ªã t√™n (h·ªó tr·ª£ c·∫£ th·∫ª input v√† th·∫ª text)
    const pInput = document.getElementById('p-username');
    const pDisplay = document.getElementById('p-username-display');
    if (pInput) pInput.value = user;
    if (pDisplay) pDisplay.innerText = user;

    // 4. Load l·ªãch s·ª≠ t·ª´ Firebase
    db.ref('wallet_history/' + user).limitToLast(20).on('value', snap => {
        const body = document.getElementById('wallet-history-body');
        if (!body) return;
        
        body.innerHTML = '';
        const data = snap.val();
        
        if (!data) {
            body.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px; color:#888;">Kh√¥ng c√≥ d·ªØ li·ªáu l·ªãch s·ª≠</td></tr>';
            return;
        }

        Object.values(data).reverse().forEach(item => {
            const amountColor = item.amount > 0 ? '#00ff00' : '#ff4444';
            const amountPrefix = item.amount > 0 ? '+' : '';
            
            body.innerHTML += `
                <tr style="border-bottom: 1px solid #333;">
                    <td style="padding: 12px; font-size:12px;">${item.date || '---'}</td>
                    <td style="padding: 12px; color:${amountColor}; font-weight:bold;">${amountPrefix}${(item.amount || 0).toLocaleString()}ƒë</td>
                    <td style="padding: 12px; color:#aaa;">${(item.balanceBefore || 0).toLocaleString()}ƒë</td>
                    <td style="padding: 12px; color:#fff;">${(item.balanceAfter || 0).toLocaleString()}ƒë</td>
                    <td style="padding: 12px;"><span style="background:#333; padding:2px 8px; border-radius:10px; font-size:11px;">${item.note || 'Giao d·ªãch'}</span></td>
                </tr>`;
        });
    });
}

function closeProfile() {
    // C√°ch an to√†n nh·∫•t: Reload trang ƒë·ªÉ giao di·ªán shop quay v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
    location.reload(); 
}
        
</script>

<div class="contact-sidebar">
    <a href="https://zalo.me/84788265513" target="_blank" class="contact-item zalo">
        <i class="fa-solid fa-comment"></i>
    </a>
    
    <a href="https://facebook.com/nvh12072006" target="_blank" class="contact-item facebook">
        <i class="fa-brands fa-facebook-f"></i>
    </a>

    <a href="https://t.me/@kunmmo2006" target="_blank" class="contact-item telegram">
        <i class="fa-brands fa-telegram"></i>
    </a>
</div>

    <div id="profile-page" style="display: none; background: #f4f6f9; min-height: 100vh; padding: 20px 0;">
    <div class="container" style="max-width: 1100px;">
        <nav style="margin-bottom: 20px; font-size: 14px;">
            <a href="#" onclick="closeProfile()" style="text-decoration:none; color:#333;">Trang ch·ªß</a> 
            <span style="color:#999;"> &gt; L·ªãch s·ª≠ giao d·ªãch</span>
        </nav>

        <div style="background: #fff; padding: 25px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display:block; margin-bottom:5px; font-weight:bold;">T√™n c·ªßa b·∫°n <span style="color:red">*</span></label>
                    <input type="text" id="p-username" disabled style="width:100%; padding:10px; border:1px solid #ddd; background:#f9f9f9;">
                </div>
                <div>
                    <label style="display:block; margin-bottom:5px; font-weight:bold;">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="text" placeholder="Ch∆∞a c·∫≠p nh·∫≠t" style="width:100%; padding:10px; border:1px solid #ddd;">
                </div>
            </div>
            <div style="margin-top:15px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">M·∫≠t kh·∫©u m·ªõi</label>
                <input type="password" id="p-new-pass" placeholder="B·ªè tr·ªëng n·∫øu gi·ªØ m·∫≠t kh·∫©u c≈©" style="width:100%; padding:10px; border:1px solid #ddd;">
            </div>
            <button class="btn" style="background:#d9534f; color:#fff; margin-top:20px; border:none; padding:10px 25px; border-radius:3px;">
                <i class="fas fa-edit"></i> C·∫≠p nh·∫≠t
            </button>
        </div>

        <div style="background: #fff; padding: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h4 style="color: #d9534f; margin-bottom: 20px;"><i class="fas fa-file-invoice-dollar"></i> L·ªãch s·ª≠ bi·∫øn ƒë·ªông s·ªë d∆∞</h4>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                            <th style="padding: 12px; text-align: left;">Th·ªùi gian</th>
                            <th style="padding: 12px; text-align: left;">S·ªë ti·ªÅn</th>
                            <th style="padding: 12px; text-align: left;">S·ªë d∆∞ tr∆∞·ªõc</th>
                            <th style="padding: 12px; text-align: left;">S·ªë d∆∞ sau</th>
                            <th style="padding: 12px; text-align: left;">Lo·∫°i</th>
                        </tr>
                    </thead>
                    <tbody id="wallet-history-body">
                        <tr><td colspan="5" style="text-align:center; padding:20px; color:#999;">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <footer style="background: #0a0a0a; border-top: 2px solid var(--primary); padding: 50px 0 20px; margin-top: 50px;">
    <div class="container">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px;">
            
            <div>
                <a href="#" class="logo" style="text-decoration: none;">HOANGKUN<span>STORE</span></a>
                <p style="color: #888; font-size: 14px; line-height: 1.6; margin-top: 15px;">
                    Chuy√™n cung c·∫•p c√°c gi·∫£i ph√°p Source Code Website, hi·ªáu ·ª©ng HTML/CSS ch·∫•t l∆∞·ª£ng cao. H·ªá th·ªëng thanh to√°n t·ª± ƒë·ªông, an to√†n v√† b·∫£o m·∫≠t.
                </p>
            </div>

            <div>
                <h4 style="color: var(--primary); text-transform: uppercase; margin-bottom: 20px;">Li√™n k·∫øt nhanh</h4>
                <ul style="list-style: none; padding: 0; font-size: 14px; line-height: 2;">
                    <li><a href="#" style="color: #ccc; text-decoration: none;">Trang ch·ªß</a></li>
                    <li><a href="https://zalo.me/84788265513" target="_blank" style="color: #ccc; text-decoration: none;">H·ªó tr·ª£ kh√°ch h√†ng</a></li>
                    <li><a href="#" onclick="showRecharge()" style="color: #ccc; text-decoration: none;">H∆∞·ªõng d·∫´n n·∫°p ti·ªÅn</a></li>
                </ul>
            </div>

            <div>
                <h4 style="color: var(--primary); text-transform: uppercase; margin-bottom: 20px;">Th√¥ng tin li√™n h·ªá</h4>
                <div style="font-size: 14px; color: #ccc; display: flex; flex-direction: column; gap: 12px;">
                    <div><i class="fas fa-phone-alt" style="color: var(--primary); width: 20px;"></i> Hotline: 0788.265.513</div>
                    <div><i class="fas fa-envelope" style="color: var(--primary); width: 20px;"></i> Email: nvh12072006@gmail.com</div>
                    <div><i class="fas fa-map-marker-alt" style="color: var(--primary); width: 20px;"></i> ƒê·ªãa ch·ªâ: H·∫£i Ph√≤ng, Vi·ªát Nam</div>
                    <div style="margin-top: 10px; display: flex; gap: 15px;">
                        <a href="https://facebook.com/nvh12072006" target="_blank" style="color: #fff; font-size: 20px;"><i class="fab fa-facebook-square"></i></a>
                        <a href="https://zalo.me/84788265513" target="_blank" style="color: #fff; font-size: 20px;"><i class="fas fa-comment-dots"></i></a>
                        <a href="https://t.me/@kunmmo2006" target="_blank" style="color: #fff; font-size: 20px;"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
            </div>

        </div>

        <hr style="border: 0; border-top: 1px solid #222; margin: 40px 0 20px;">
        
        <p style="text-align: center; color: #555; font-size: 12px;">
            &copy; 2024 - 2026 <b>HOANGKUN STORE</b>. All Rights Reserved. Thi·∫øt k·∫ø b·ªüi <b>Nguyen Viet Hoang</b>
        </p>
    </div>
</footer>

<div id="profile-page" style="display: none; background: #f4f6f9; min-height: 100vh; padding: 20px 0; position: fixed; top: 0; left: 0; width: 100%; z-index: 10000; overflow-y: auto;">
    <div class="container" style="max-width: 1000px; margin: auto; font-family: sans-serif;">
        <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <h4 style="border-left: 5px solid #d9534f; padding-left: 15px; color: #333; margin: 0; text-align: left;">TH√îNG TIN T√ÄI KHO·∫¢N</h4>
            <hr style="border: 0.5px solid #eee; margin: 15px 0;">
            <p style="font-size: 16px; color: #555; text-align: left;">T√™n t√†i kho·∫£n: <b id="p-username-display" style="color: #d9534f;">---</b></p>
        </div>

        <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h4 style="border-left: 5px solid #d9534f; padding-left: 15px; color: #333; margin-bottom: 20px; text-align: left;">L·ªäCH S·ª¨ BI·∫æN ƒê·ªòNG S·ªê D∆Ø</h4>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                            <th style="padding: 12px; text-align: left; color: #444;">Th·ªùi gian</th>
                            <th style="padding: 12px; text-align: left; color: #444;">S·ªë ti·ªÅn</th>
                            <th style="padding: 12px; text-align: left; color: #444;">S·ªë d∆∞ cu·ªëi</th>
                            <th style="padding: 12px; text-align: left; color: #444;">N·ªôi dung</th>
                        </tr>
                    </thead>
                    <tbody id="wallet-history-body" style="color: #333;">
                        <tr><td colspan="4" style="text-align:center; padding:30px; color: #999;">ƒêang t·∫£i l·ªãch s·ª≠...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="closeProfile()" style="padding: 12px 30px; cursor: pointer; background: #333; color: #fff; border: none; border-radius: 5px; font-weight: bold;">
                <i class="fas fa-arrow-left"></i> QUAY L·∫†I C·ª¨A H√ÄNG
            </button>
        </div>
    </div>
</div>
    
<style>
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

    @keyframes pulseBtn {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 20px rgba(255, 65, 108, 0.6); }
    100% { transform: translate(-50%, -50%) scale(1); }
}

#spinBtn:not(:disabled) {
    animation: pulseBtn 1.5s infinite;
}
    
</style>
    
</body>
</html>
